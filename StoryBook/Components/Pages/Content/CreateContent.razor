@rendermode InteractiveServer
@inject NavigationManager Navigation

@{
    List<StoryParameterData> parameterData = StoryParameterManager.GetAvailableParameters();
    bool isFirstMainLineStyle = true;

    // Story parameters (sections)
    foreach (StoryParameterData data in parameterData)
    {
        if ((data == null) || (data.SectionName == null) || (data.Parameters == null))
        {
            continue;
        }

        string sectionName = data.SectionName;
        int sectionId = data.SectionId;
        bool isMultiSelection = data.IsMultiSelection;
        List<string> sectionParameters = data.Parameters;

        string mainLineClass = "stack-mainline-1";

        if (!isFirstMainLineStyle)
        {
            mainLineClass = "stack-mainline-2";
        }

        isFirstMainLineStyle = !isFirstMainLineStyle;

        <div class="@mainLineClass">
            <div class="flex-center stack-child-title">
                @sectionName
            </div>
            <div class="flex-center-vertical stack-child-parameters">
                @{
                    // We have multi-select parameters. Create toggle buttons.
                    if (isMultiSelection)
                    {
                        <Stack IsRow="true" Justify="StackJustifyContent.Start" AlignItems="StackAlignItems.Stretch" IsWrap="true"
                            IsReverse="false">
                            @{
                                for (int paramIndex = 0; paramIndex < sectionParameters.Count; paramIndex++)
                                {
                                    string paramName = sectionParameters[paramIndex];

                                    <StackItem>
                                        <div class="stack-item-demo">
                                            <StoryParameterToggle Class="stack-button" SectionId=@sectionId ParamName=@paramName />
                                        </div>
                                    </StackItem>
                                }
                            }
                        </Stack>
                    }
                    // We don't have multi-select parameters. Create a radio list.
                    else
                    {
                        <StoryParameterRadioList SectionId=@sectionId />
                    }
                }
            </div>
        </div>
    }
}

<div class="flex-center-vertical stack-line-confirm">
    <Button class="stack-button stack-button-confirm" Color="Color.Success" @onclick="OnCreate">CREATE</Button>
</div>

@code {
    protected override void OnInitialized()
    {
        base.OnInitialized();

        // Create available story parameters.
        StoryParameterManager.CreateAvailableParameters();
    }

    private void OnCreate()
    {
        Navigation.NavigateTo("/Generate");
    }
}